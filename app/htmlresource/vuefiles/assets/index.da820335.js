import{T as C}from"./index.3f34d0c0.js";import{q as v,d as B,L as $,k as f,v as S,_ as E,r,o as c,x as D,w as s,b as o,y as w,c as A,z as L,F as T,j as k,A as V,a as F,B as N,f as b,t as g}from"./index.79adc836.js";import{g as P}from"./remote.5f97b09a.js";import{f as G}from"./date.df283880.js";import{P as U,S as I,D as O}from"./Search.d0043b8e.js";function j(){return v({url:"/sshtunnel/list",method:"get"})}function J(e){return v({url:"/sshtunnel/add",method:"post",data:e})}function q(e){return v({url:"/sshtunnel/del",method:"post",data:e})}const z=B({components:{Layer:$},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0})},data:{type:Array,default:[]}},setup(e,t){const a=f(null),m=f(null);let i=f({Local:"",Svcname:"",ID:""});const p={};n();function n(){e.layer.row&&(i.value=JSON.parse(JSON.stringify(e.layer.row)))}const l=f([]);function h(){P().then(y=>{l.value=y.data})}return h(),{BDP:S(()=>!!i.value.Local),selectData:l,form:i,rules:p,layerDom:m,ruleForm:a}},methods:{submit(){this.ruleForm&&this.ruleForm.validate(e=>{if(e){let t=this.form;if(this.layer.row)this.delForm({svcname:t.ID});else{let a=this.pd(t.Svcname);console.log("select: ",a),a?this.addForm(t):(this.$message({type:"success",message:"\u4F60\u5DF2\u7528\u6237\u8BE5\u670D\u52A1\u7684\u8BBF\u95EE\u6743\u9650"}),this.layer.show=!1)}}else return!1})},addForm(e){J(e).then(t=>{this.$message({type:"success",message:"\u65B0\u589E\u6210\u529F"}),this.$emit("getTableData"),this.layerDom&&this.layerDom.close()})},delForm(e){q(e).then(t=>{this.$message({type:"success",message:"\u5220\u9664\u6210\u529F"}),this.$emit("getTableData"),this.layerDom&&this.layerDom.close()})},pd(e){let t=1;return this.data.forEach(a=>{a.ID===e&&(t=0)}),t===1}}});function H(e,t,a,m,i,p){const n=r("el-input"),l=r("el-form-item"),h=r("el-option"),_=r("el-select"),y=r("el-form"),d=r("Layer",!0);return c(),D(d,{layer:e.layer,data:e.data,onConfirm:e.submit,ref:"layerDom"},{default:s(()=>[o(y,{model:e.form,rules:e.rules,ref:"ruleForm","label-width":"120px",style:{"margin-right":"30px"}},{default:s(()=>[e.BDP?(c(),D(l,{key:0,label:"\u672C\u5730\u8BBF\u95EE\u7AEF\u53E3: ",prop:"Host"},{default:s(()=>[o(n,{modelValue:e.form.Local,"onUpdate:modelValue":t[0]||(t[0]=u=>e.form.Local=u)},null,8,["modelValue"])]),_:1})):w("",!0),o(l,{label:"\u8FDC\u7AEF\u670D\u52A1\uFF1A",prop:"Svcname"},{default:s(()=>[o(_,{modelValue:e.form.Svcname,"onUpdate:modelValue":t[1]||(t[1]=u=>e.form.Svcname=u),placeholder:"\u8BF7\u9009\u62E9",clearable:""},{default:s(()=>[(c(!0),A(T,null,L(e.selectData,u=>(c(),D(h,{key:u.value,label:u.label,value:u.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["layer","data","onConfirm"])}var R=E(z,[["render",H]]);const K=B({name:"sshinfo",components:{Table:C,Layer:R},setup(){const e=f(!0),t=f([]),a=k({show:!1,title:"\u65B0\u589E",showButton:!0}),m=()=>{e.value=!0,j().then(n=>{t.value=n.data}).catch(()=>{t.value=[]}).finally(()=>{e.value=!1})},i=()=>{a.title="\u65B0\u589E\u6570\u636E",a.show=!0,delete a.row},p=n=>{a.title="\u5220\u9664\u6570\u636E",a.row=n,a.show=!0};return m(),{Plus:U,Search:I,Delete:O,tableData:t,loading:e,layer:a,handleAdd:i,handleEdit:p,getTableData:m,formatDate:G}}}),M={class:"layout-container"},Q={class:"layout-container-form flex space-between"},W={class:"layout-container-form-handle"},X=b("\u7533\u8BF7\u65B0\u7684\u8BBF\u95EE"),Y={class:"layout-container-table"},Z=b("\u5220\u9664");function x(e,t,a,m,i,p){const n=r("el-button"),l=r("el-table-column"),h=r("Table"),_=r("Layer"),y=V("loading");return c(),A("div",M,[F("div",Q,[F("div",W,[o(n,{type:"primary",icon:e.Plus,onClick:e.handleAdd},{default:s(()=>[X]),_:1},8,["icon","onClick"])])]),F("div",Y,[N((c(),D(h,{ref:"table",data:e.tableData,onGetTableData:e.getTableData},{default:s(()=>[o(l,{prop:"Local",label:"\u5185\u90E8\u8BBF\u95EE\u7AEF\u53E3",align:"center"}),o(l,{prop:"Svcname",label:"\u8FDC\u7AEF\u670D\u52A1",align:"center"}),o(l,{prop:"CreatedAt",label:"\u7533\u8BF7\u65F6\u95F4",align:"center"},{default:s(d=>[b(g(e.formatDate(d.row.CreatedAt)),1)]),_:1}),o(l,{prop:"UpdatedAt",label:"\u5BA1\u6279\u65F6\u95F4",align:"center"},{default:s(d=>[b(g(e.formatDate(d.row.UpdatedAt)),1)]),_:1}),o(l,{label:"\u64CD\u4F5C",align:"center",fixed:"right",width:"200"},{default:s(d=>[o(n,{onClick:u=>e.handleEdit(d.row)},{default:s(()=>[Z]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onGetTableData"])),[[y,e.loading]]),e.layer.show?(c(),D(_,{key:0,layer:e.layer,data:e.tableData,onGetTableData:e.getTableData},null,8,["layer","data","onGetTableData"])):w("",!0)])])}var se=E(K,[["render",x]]);export{se as default};
